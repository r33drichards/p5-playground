<!DOCTYPE html>
<html>

<head>
    <title>L-System Renderer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
</head>

<style>
    body {
        margin: 0;
        padding: 0;
        overflow: hidden;
    }
</style>

<script>
    let axiom = "F";
    let rules = [
        {
            pre: "F",
            next: "F[+FF][-FF]F[-F][+F]F",
        },
    ];
    let sentence = axiom;
    let len = 512;
    let generations = 4;
    let angle = 45;
    let angleIncrement = 0.001;  // Controls the speed of angle change

    function setup() {
        createCanvas(windowWidth, windowHeight);
        background(255);

        // Generate the L-system sentence
        for (let i = 0; i < generations; i++) {
            applyRules();
            len *= 0.5;
        }
    }

    function draw() {
        background(255);
        angle += angleIncrement;

        // Draw three turtles at the bottom of the canvas
        for (let i = 0; i < 3; i++) {
            let x = width / 3 * i + width / 6;
            let y = height;
            push();
            turtle(x, y);
            pop();
        }

        // Draw three turtles at the top of the canvas
        for (let i = 0; i < 3; i++) {
            let x = width / 3 * i + width / 6;
            let y = 0;
            push();
            upsideDownTurtle(x, y);
            pop();
        }
        console.log(frameCount);
        if (frameCount % 1500 == 0) {
            changeAngle();
        }
    }

    function changeAngle() {
        switch (angleIncrement) {
            case -0.001:
                angleIncrement = 0.001;
                break;
            case 0.001:
                angleIncrement = -0.001;
                break;
        }
    }

    function turtle(x, y) {
        translate(x, y);
        stroke(0);
        noFill();
        for (let i = 0; i < sentence.length; i++) {
            let current = sentence.charAt(i);
            if (current === "F") {
                stroke(0);
                line(0, 0, 0, -len);
                translate(0, -len);
            } else if (current === "+") {
                rotate(angle);
            } else if (current === "-") {
                rotate(-angle);
            } else if (current === "[") {
                push();
            } else if (current === "]") {
                pop();
            }
        }
    }

    function upsideDownTurtle(x, y) {
        translate(x, y);
        stroke(0);
        noFill();
        for (let i = 0; i < sentence.length; i++) {
            let current = sentence.charAt(i);
            if (current === "F") {
                stroke(0);
                line(0, 0, 0, len);
                translate(0, len);
            } else if (current === "+") {
                rotate(-angle);
            } else if (current === "-") {
                rotate(angle);
            } else if (current === "[") {
                push();
            } else if (current === "]") {
                pop();
            }
        }
    }

    function applyRules() {
        let nextSentence = "";
        for (let i = 0; i < sentence.length; i++) {
            let current = sentence.charAt(i);
            let replaced = false;
            for (let j = 0; j < rules.length; j++) {
                if (current === rules[j].pre) {
                    nextSentence += rules[j].next;
                    replaced = true;
                    break;
                }
            }
            if (!replaced) {
                nextSentence += current;
            }
        }
        sentence = nextSentence;
    }
</script>

<body>
</body>

</html>
